var rtc = require('../');
var connections = [
  rtc.createConnection(),
  rtc.createConnection()
];

function handleError(err) {
  console.error(err);
}

connections[0].createOffer(function(sdp) {
  console.log('got sdp', sdp);

  connections[0].setLocalDescription(sdp, function() {
    console.log('ok');

      connections[1].setRemoteDescription(sdp, function() {
        console.log('remote sdp ok');

        connections[1].createAnswer(function(sdp2) {
          console.log('got sdp #2', sdp2);

          connections[1].setLocalDescription(sdp2, function() {
            console.log('ok #2');

//             console.log('attempting to break connection');
//             connections[1].createAnswer(function(sdp3) {
//               console.log('got sdp #3', sdp3);
//               connections[1].setLocalDescription(sdp3, function() {
//                 console.log('ok #3');
//               }, handleError)
//             });

            console.log('attempting to break connection');
            connections[1].setLocalDescription(sdp2, function() {
              console.log('ok #3');
            }, handleError);

            connections[0].setRemoteDescription(sdp2, function() {
              console.log('signaling done');
            }, handleError);
          }, handleError);
        }, handleError);
      }, handleError);
  }, handleError);
}, handleError);
